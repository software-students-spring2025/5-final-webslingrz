{% extends "base.html" %}

{% block content %}
<div class="container">
    <div class="row mb-4">
        <div class="col-12">
            <h2>Bird Game Dashboard</h2>
            <p class="lead">Your current money: ${{ money }}</p>
        </div>
    </div>
    
    <div class="row">
        <div class="col-12">
            <div id="game-container" style="width: 800px; height: 600px; border: 2px solid #3498db; border-radius: 5px; margin: 0 auto;">
                <iframe id="game-frame" src="{{ url_for('game.play') }}" style="width: 100%; height: 100%; border: none;"></iframe>
            </div>
        </div>
    </div>
    
    <div class="row mt-3">
        <div class="col-12 text-center">
            <a href="{{ url_for('game.birds') }}" class="btn btn-primary">View Bird Collection</a>
            <button class="btn btn-success" id="build-btn">Rebuild Game</button>
            <div id="build-status" style="margin-top: 10px; color: #7f8c8d;"></div>
        </div>
    </div>
</div>

<script>
    document.getElementById('build-btn').addEventListener('click', function(event) {
        event.preventDefault();
        
        const statusElement = document.getElementById('build-status');
        statusElement.textContent = "Building game... (this may take a minute)";
        
        fetch("{{ url_for('game.build_game') }}", {
            method: 'POST'
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                statusElement.textContent = "Game built successfully! Refreshing...";
                statusElement.style.color = "#27ae60";
                setTimeout(() => {
                    document.getElementById('game-frame').src = document.getElementById('game-frame').src;
                }, 1000);
            } else {
                statusElement.textContent = "Build failed: " + data.message;
                statusElement.style.color = "#c0392b";
            }
        })
        .catch(error => {
            statusElement.textContent = "Error: " + error;
            statusElement.style.color = "#c0392b";
        });
    });
</script>
{% endblock %}